# 磁盘健康与性能分析工具 (Disk Health Analyzer)

一个用于 Linux 系统的轻量级、交互式磁盘健康状态检测与读写测速脚本。本工具能够智能识别并解析 eMMC、NVMe SSD 以及 SATA HDD/SSD 的底层 S.M.A.R.T. 与运行状态数据，为您提供直观的可视化健康度报告。

## 🌟 核心功能

- **智能硬件识别**：自动区分 SATA/SAS 硬盘、NVMe 固态硬盘和 eMMC 存储芯片，针对不同设备采用不同的解析策略。
- **深度健康分析**：
  - **SATA/机械硬盘**：读取通电时间、当前温度、重映射扇区（物理坏道报警）、待处理扇区以及寿命百分比。
  - **NVMe 固态硬盘**：精确解析已用寿命百分比、写入总量/读取量、通电次数，并支持多传感器温度读取（NAND 温度 / 主控温度）。
  - **eMMC 存储**：读取底层 SLC/MLC 区域擦写消耗，估算 eMMC 芯片寿命。
- **高精度性能测速**：
  - 自动寻找所选磁盘的挂载点进行无损测速。
  - **智能 fio 测速**：当系统安装了 `fio` 工具时，优先调用 `libaio` 引擎和 `direct=1` 进行原生极致的裸盘级顺序读写测速。
  - **dd 兼容测速**：如果没有 `fio`，则智能降级使用 `dd` 兼容模式进行测速。
- **全平台依赖管理**：
  - 主动拦截并校验系统底层命令 (`lsblk`, `df`, `awk` 等)。
  - 当缺失 `smartmontools` 时，全面支持常用包管理器的自动安装与免残留卸载：`apt` (Debian/Ubuntu)、`yum` (CentOS/RH)、`pacman` (Arch 系)、`apk` (Alpine)。

## 🚀 快速开始

### 运行环境
- **操作系统**：Linux 通用 (Debian/Ubuntu, CentOS/RHEL, Arch, Alpine 等)
- **权限要求**：因为需要跨文件系统读取底层硬件信息，**必须以 `root` 权限 (或 `sudo`) 运行**。

### 运行方式
```bash
# 克隆仓库并进入目录
git clone https://github.com/dff652/disk-health-analyzer.git
cd disk-health-analyzer

# 赋予执行权限
chmod +x disk_analyzer.sh

# 运行脚本
sudo ./disk_analyzer.sh
```

## 🛠 使用说明

脚本采用交互式命令行界面：
1. **选择磁盘**：输入 `1` 扫描系统存在的物理磁盘，并输入序号选择你需要检测的硬盘。
2. **查看寿命与健康度**：输入 `2`，脚本将输出可视化进度条和重要状态指标。如果存在过热、寿命极低或危险坏道，会有红黄警钟高亮警告。
3. **读写性能测试**：输入 `3`，本工具会在该磁盘所在的挂载点自动执行 `fio` 或 `dd` 读写测速。
4. **卸载依赖**：如果脚本曾替你自动安装了 `smartmontools`，可以输入 `4` 进行洁净卸载。随时输入 `q` 退出。

## ⚠️ 注意事项
- 测试性能时采用 100MB 级别数据测速。需要磁盘至少存在一个**已挂载**的分区，如果磁盘未格式化未挂载则无法进行读写测速。
- 测试生成的临时文件会在操作结束后自动强制清理。
- **数据无价**：本工具仅提供状态估算和参考，发现磁盘报错、重映射扇区增加等异常时请尽快备份重要数据。

## 📜 许可证
供技术交流与测试使用。
